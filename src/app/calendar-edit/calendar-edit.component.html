<div *ngIf="pageLoading">
	<br><br>
	<app-loading></app-loading>
	<br><br>
</div>
<div *ngIf="pageLoaded">
	<div class="sections">
		<div class="section s1 center-text">
			<h3 class="primary">Create New Event</h3>
			<mat-form-field class="m-input" appearance="fill" color="primary">
				<mat-label>Title of Event*</mat-label>
				<input type="text" matInput [(ngModel)]="event_name">
			</mat-form-field>
			<br><br>
			<mat-form-field class="m-input" appearance="fill" color="primary">
				<mat-label>Event Type*</mat-label>
				<mat-select [(value)]="event_type">
					@for (e_type of event_types; track e_type) {
					<mat-option [value]="e_type">{{e_type}}</mat-option>
					}
				</mat-select>
			</mat-form-field>
			<br><br>
			<mat-form-field class="m-input" appearance="fill" color="primary">
				<mat-label>Start Date*</mat-label>
				<input matInput [matDatepicker]="picker" [value]="event_start_date" [min]="min_date" [max]="max_date"
					(dateChange)="setEventDate('input', $event, true)">
				<mat-hint>DD/MM/YYYY</mat-hint>
				<mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
				<mat-datepicker #picker></mat-datepicker>
			</mat-form-field>
			<br><br>
			<mat-form-field class="m-input" appearance="fill" color="primary">
				<mat-label>End Date*</mat-label>
				<input matInput [matDatepicker]="picker_two" [value]="event_end_date" [min]="min_date" [max]="max_date"
					(dateChange)="setEventDate('input', $event, false)">
				<mat-hint>DD/MM/YYYY</mat-hint>
				<mat-datepicker-toggle matIconSuffix [for]="picker_two"></mat-datepicker-toggle>
				<mat-datepicker #picker_two></mat-datepicker>
			</mat-form-field>
			<br><br>
			<h5 class="center-text">
				Applicable Groups*
			</h5>
			<mat-radio-group [(ngModel)]="event_invite_group">
				@for (group of invite_groups; track group) {
				<mat-radio-button [color]="'primary'" [value]="group">{{group.name}}</mat-radio-button>
				}
			</mat-radio-group>
			<br><br>
			<div *ngIf="event_invite_group.value !== 'g'">
				<mat-form-field class="m-input" appearance="fill" color="primary">
					<mat-label>{{event_invite_group.name}}</mat-label>
					<mat-select *ngIf="event_invite_group.value == 'd'" [(value)]="group_value" multiple>
						@for (department of departments; track department) {
						<mat-option [value]="department.d_id">{{department.name}}</mat-option>
						}
					</mat-select>
					<mat-select *ngIf="event_invite_group.value == 'i'" [(value)]="group_value" multiple>
						@for (admin of staff; track admin) {
						<mat-option [value]="admin.a_id">{{admin.f_name}} {{admin.l_name}}</mat-option>
						}
					</mat-select>
				</mat-form-field>
				<br><br>
			</div>
			<mat-form-field class="m-input textarea" appearance="fill" color="primary">
				<mat-label>Event Description</mat-label>
				<textarea class="textarea" matInput [(ngModel)]="event_description"></textarea>
			</mat-form-field>
			<br><br>
			<mat-form-field class="m-input" appearance="fill" color="primary" *ngIf="event_invite_group.value !== 'i'">
				<mat-label>Applicable Access Levels*</mat-label>
				<mat-select [(value)]="event_access_levels" multiple>
					@for (level of access_levels; track level) {
					<mat-option [value]="level.tier">{{level.name}}</mat-option>
					}
				</mat-select>
			</mat-form-field>
			<div class="right-text m-input center">
				<button mat-button color="primary" (click)="selectAllLevels()">Select All</button>
			</div>
			<br><br>
			<button *ngIf="!saveLoading" class="button p-btn hov" (click)="validate()" mat-raised-button
				color="primary">Save Event</button>
			<app-loading *ngIf="saveLoading"></app-loading>
		</div>
		<div class="section s2">
			<h3 class="center-text primary">Upcoming Events</h3>
			<h5 *ngIf="upcoming_events.length === 0" class="center-text italic">No Upcoming Events</h5>
			<mat-card *ngFor="let event of upcoming_events" class="event-card">
				<div class="right-text">
					<button mat-icon-button aria-label="Edit Event button" (click)="editEvent(event)">
						<mat-icon color="warn">edit</mat-icon>
					</button>
				</div>
				<mat-card-content class="card-content">
					<div class="r-div">
						<span>Starts</span>
						<br>
						<div class="cal-div">
							{{event.start_date | date:'MMM'}}
							<br>
							{{event.start_date | date:'dd'}}
						</div>
					</div>
					<div class="c-div">
						<h2>{{event.name}}</h2>
						<div class="left-text">
							<div *ngIf="event.description.length > 0">
								<h5 class="center-text primary">Description</h5>
								<div class="small-text italic">{{event.description}}</div>
							</div>
							<div>
								<h5 class="center-text primary">Invitees</h5>
								<p *ngIf="event.group === 'g'" class="s-dark">Company-Wide</p>
								<p *ngIf="event.group !== 'g'"><span class="bold">{{event.group_name}}:</span>
									{{event.group_invitee_names.join(', ')}}</p>
								<div *ngIf="event.group !== 'i'">
									<p *ngIf="event.access_levels.length === access_levels.length"><span
											class="bold">Access Levels:</span> <span class="s-dark"> All Access
											Levels</span></p>
									<p *ngIf="event.access_levels.length !== access_levels.length"><span
											class="bold">Access Levels:</span> {{event.access_levels.join(', ')}}</p>
								</div>
							</div>
						</div>
					</div>
					<div class="l-div">
						<span>Ends</span>
						<br>
						<div class="cal-div">
							{{event.end_date | date:'MMM'}}
							<br>
							{{event.end_date | date:'dd'}}
						</div>
					</div>
				</mat-card-content>
			</mat-card>
		</div>
		<div class="section s3 center-text">
			<h3 class="center-text primary">Previous Events</h3>
			<h5 *ngIf="previous_events.length === 0" class="center-text italic">No Previous Events</h5>
			<div *ngFor="let event_year of previous_events; index as i">
				<mat-expansion-panel class="year-card" (opened)="loadPreviousEvents(i)">
					<mat-expansion-panel-header>
						<mat-panel-title class="header"> {{event_year.year}} Events </mat-panel-title>
					</mat-expansion-panel-header>
					<div *ngIf="event_year.loading">
						<br><br>
						<app-loading></app-loading>
						<br><br>
					</div>
					<h5 *ngIf="event_year.events.length === 0 && event_year.loaded" class="center-text italic">No Events
						for {{event_year.year}}</h5>
					<mat-card *ngFor="let event of event_year.events" class="event-card">
						<mat-card-content class="card-content">
							<div class="r-div">
								<span>Started</span>
								<br>
								<div class="cal-div">
									{{event.start_date | date:'MMM'}}
									<br>
									{{event.start_date | date:'dd'}}
								</div>
							</div>
							<div class="c-div">
								<h2>{{event.name}}</h2>
								<div class="left-text">
									<div *ngIf="event.description.length > 0">
										<h5 class="center-text primary">Description</h5>
										<div class="small-text italic">{{event.description}}</div>
									</div>
									<div>
										<h5 class="center-text primary">Invitees</h5>
										<p *ngIf="event.group === 'g'" class="s-dark">Company-Wide</p>
										<p *ngIf="event.group !== 'g'"><span class="bold">{{event.group_name}}:</span>
											{{event.group_invitee_names.join(', ')}}</p>
										<div *ngIf="event.group !== 'i'">
											<p *ngIf="event.access_levels.length === access_levels.length"><span
													class="bold">Access Levels:</span> <span class="s-dark"> All Access
													Levels</span></p>
											<p *ngIf="event.access_levels.length !== access_levels.length"><span
													class="bold">Access Levels:</span> {{event.access_levels.join(',
												')}}</p>
										</div>
									</div>
								</div>
							</div>
							<div class="l-div">
								<span>Ended</span>
								<br>
								<div class="cal-div">
									{{event.end_date | date:'MMM'}}
									<br>
									{{event.end_date | date:'dd'}}
								</div>
							</div>
						</mat-card-content>
					</mat-card>
				</mat-expansion-panel>
			</div>
		</div>
	</div>
</div>
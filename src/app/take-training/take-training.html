@if(pageLoading){
<div>
	<br><br><br><br>
	<app-loading></app-loading>
</div>
}
@if(!testInProgress){
<div>
	@if(pageLoaded && !previewing){
	<div class="page">
		<div class="main-content">
			<h2 class="center-text">{{training!.title}} | SNL Nigeria Staff Training Course</h2>
			@if(!training!.internal){
			<div class="center-text">
				<a matButton="outlined" color="primary" href="{{training!.link}}" target="_blank">Training Link</a>
			</div>
			}
			@if(!training!.progress.started){
			<div class="start-div center-text">
				@if(!startLoading){
				<button mat-flat-button color="primary" (click)="startTraining()">Start Training
					<mat-icon>play_circle</mat-icon></button>
				}
				@else {
				<app-loading></app-loading>
				}
			</div>
			}
			@else if(training!.progress.started && training!.internal){
			<div class="content-div center">
				<h3 class="center-text primary">{{activeContent?.heading}}</h3>
				<div class="content" [innerHTML]="activeContent?.content"></div>
				<div class="content-actions">
					<button [disabled]="!prevActive" matFab (click)="prev()">
						<mat-icon color="primary">arrow_back_ios</mat-icon>
					</button>
					<span class="progress-marker">{{content_index + 1}} / {{training!.content.length}}</span>
					<button [disabled]="!nextActive" matFab (click)="next()">
						<mat-icon color="primary">arrow_forward_ios</mat-icon>
					</button>
				</div>
				<div class="center-text">
					<br><br><br>
					@if(!nextActive){
					<button mat-flat-button color="primary" (click)="startTest()">Start Test
						<mat-icon>play_circle</mat-icon></button>
					}
					@if(testLoading){
					<app-loading></app-loading>
					}
				</div>
			</div>
			}
			@else if(training!.progress.started && !training!.internal){
			<div class="content-div center">
				<h3 class="center-text primary">{{activeContent?.heading}}</h3>
				<div class="content" [innerHTML]="activeContent?.content"></div>
				<br><br>
				<hr>
				<h4>Log your progress every time you begin a new segment. Utilise "Additional Notes" to provide more
					context. The URL is that of the page you're taking the current training segment on</h4>
				<br><br>
				<div class="progress-form center-text">
					<mat-form-field class="m-input" appearance="fill" color="primary">
						<mat-label>URL</mat-label>
						<input type="text" matInput [(ngModel)]="url">
					</mat-form-field>
					<br><br>
					<mat-form-field class="m-input" appearance="fill" color="primary">
						<mat-label>Additional Notes (optional)</mat-label>
						<textarea type="text" matInput [(ngModel)]="notes"></textarea>
					</mat-form-field>
					<br><br><br>
					@if(!updateLoading){
					<button class="button p-btn hov" (click)="updateTrainingProgress()" matButton="filled"
						color="primary">Log Progress</button>
					}
					@else {
					<app-loading></app-loading>
					}
				</div>
				<br><br><br>
				<hr>
				<div>
					<br><br><br>
					@if(!nextActive){
					<button mat-flat-button color="primary" (click)="startTest()">Start Test
						<mat-icon>play_circle</mat-icon></button>
					}
					@if(testLoading){
					<app-loading></app-loading>
					}
				</div>
			</div>
			}
		</div>
		@if(training!.internal){
		<div class="sidebar">
			<h3 class="center-text primary">Training Assets</h3>
			@if(training_assets.length === 0){
			<div class="center-text italic">
				<br><br><br>
				<h5>No Training Assets</h5>
			</div>
			}
			<div class="assets-div">
				@for(asset of training_assets; track asset.a_id; let i = $index){
				<div class="asset">
					@if(asset.type === 1){
					<mat-icon>description</mat-icon>
					}
					@if(asset.type === 2){
					<mat-icon>image</mat-icon>
					}
					@if(asset.type === 3){
					<mat-icon>movie</mat-icon>
					}
					@if(asset.type === 4){
					<mat-icon>music_note</mat-icon>
					}
					<span>{{asset.label}}</span>
					<span class="asset-actions">
						@if(asset.type === 2){
						<button class="asset-action" (click)="previewAsset(i)" matIconButton
							color="primary"><mat-icon>preview</mat-icon></button>
						}
						<button class="asset-action" (click)="downloadAsset(asset.uri)" matIconButton
							color="primary"><mat-icon>download</mat-icon></button>
					</span>
				</div>
				}
			</div>
		</div>
		}
		@else {
		<div class="sidebar">
			<h3 class="center-text primary">Training Progress</h3>
			@if(training!.progress.activity.length === 0){
			<div class="center-text italic">
				<br><br><br>
				<h5>No Training Progress</h5>
			</div>
			}
			<div class="progress-div">
				@for(progress of training!.progress!.activity; track progress.id; let i = $index){
				<div class="progress">
					<div>
						<span class="bold">URL</span><span>: {{progress.id}}</span>
					</div>
					<div>
						<span class="bold">On</span><span>: {{progress.on | date}}</span>
					</div>
					<div>
						<span class="bold">Notes</span><span>: {{progress.action}}</span>
					</div>
					<hr>
				</div>
				}
			</div>
		</div>
		}
	</div>
	}
	@if(pageLoaded && previewing){
	<div class="preview">
		<div class="right-text pad">
			<button (click)="closePreview()" mat-mini-fab color="primary" aria-label="Icon Button with a close icon">
				<mat-icon>close</mat-icon>
			</button>
		</div>
		<img src="{{preview_uri}}" alt="Image" class="preview-img">
	</div>
	}
</div>
}
@else {
<div class="test-page center">
	@if(testLoaded && !scoring && !scoringCompleted){
	<div class="right-text bold">
		<span class="{{time_colour}}">{{elapsed_time}}</span> / {{test_time}}
	</div>
	}
	<h2 class="center-text">{{training!.title}} | SNL Nigeria Staff Training Test</h2>
	@if(testLoading || scoring){
	<div>
		<br><br><br><br>
		<app-loading></app-loading>
	</div>
	}
	@if(testLoaded && !testTimeElapsed && !scoring && !scoringCompleted){
	<div class="questions-content">
		<div class="center-text">
			<span class="progress-marker grey-text">{{question_index + 1}} / {{questions.length}}</span>
			<br><br>
		</div>
		<div class="question">
			<div class="question-text">
				{{questions[question_index].question}}
			</div>
			<div class="question-options">
				<mat-radio-group [name]="'question_options'" [(ngModel)]="questions[question_index].selected_index">
					@for(option of questions[question_index].options; track $index; let i = $index){
					<div>
						<div class="question-option">
							<label class="hov">
								<mat-radio-button [value]="i" [color]="'primary'"></mat-radio-button>
								<span class="option-text">{{option}}</span>
							</label>
						</div>
						<br>
					</div>
					}
				</mat-radio-group>
			</div>
		</div>
		<div class="content-actions">
			<button [disabled]="!prevQuestionActive" matFab (click)="prevQuestion()">
				<mat-icon color="primary">arrow_back_ios</mat-icon>
			</button>
			<button [disabled]="!nextQuestionActive" matFab (click)="nextQuestion()">
				<mat-icon color="primary">arrow_forward_ios</mat-icon>
			</button>
		</div>
		<div class="center-text">
			<br><br><br>
			@if(!nextQuestionActive){
			<button mat-flat-button color="primary" (click)="completeTest(false)">Submit
				Responses
				<mat-icon>play_circle</mat-icon></button>
			}
			@if(testLoading){
			<app-loading></app-loading>
			}
		</div>
	</div>
	}
	@else if (testTimeElapsed) {
	<div>
		<h3 class="center-text">Test Time Elapsed</h3>
		<div class="elapsed-content">
			The time allotted for this Test has elapsed. You may submit your completed responses now and forfeit the
			rest of the test. If your grade reaches the passing grade for the test,
			this Training will be marked as completed. If it doesn't, you will be required to take the training again.
			<br><br>
			Alternatively, you may choose to take the training again.
			<br><br><br>
			<div class="center-text test-buttons-div">
				<button mat-flat-button color="primary" class="test-button" (click)="completeTest(true)">Submit
					Responses
					<mat-icon>play_circle</mat-icon></button>
				<button mat-flat-button color="primary" class="test-button" (click)="retakeTraining()">Retake Training
					<mat-icon>refresh</mat-icon></button>
			</div>
		</div>
	</div>
	}
	@else if(scoringCompleted){
	<div>
		<h3 class="center-text">Congratulations on successfully completing this Training! You scored:
			{{percentage_score}}% on the Test.</h3>
	</div>
	}
</div>
}